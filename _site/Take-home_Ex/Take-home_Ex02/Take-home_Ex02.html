<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gerald Lim">
<meta name="dcterms.date" content="2024-03-03">

<title>IS415-GAA - Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03_1.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03_2.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05_1.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05_2.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex11/Hands-on_Ex11.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 11</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03-NKDE.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3 NKDE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex06.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex07.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex08.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10/In-class_Ex10.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-the-scene" id="toc-setting-the-scene" class="nav-link active" data-scroll-target="#setting-the-scene"><strong>Setting the Scene</strong></a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives"><strong>Objectives</strong></a></li>
  <li><a href="#install-maptools" id="toc-install-maptools" class="nav-link" data-scroll-target="#install-maptools">1 Install maptools</a></li>
  <li><a href="#data-import-wrangling-and-analysis" id="toc-data-import-wrangling-and-analysis" class="nav-link" data-scroll-target="#data-import-wrangling-and-analysis">2 Data Import, Wrangling and Analysis</a>
  <ul>
  <li><a href="#taiwan-village-data-taiwan_village_sf" id="toc-taiwan-village-data-taiwan_village_sf" class="nav-link" data-scroll-target="#taiwan-village-data-taiwan_village_sf">2.1 Taiwan Village Data (taiwan_village_sf)</a>
  <ul class="collapse">
  <li><a href="#import-the-csv-data-tainan_village.shp" id="toc-import-the-csv-data-tainan_village.shp" class="nav-link" data-scroll-target="#import-the-csv-data-tainan_village.shp">2.1.1 Import the csv data (TAINAN_VILLAGE.shp)</a></li>
  <li><a href="#filtering-the-taiwan_village_sf." id="toc-filtering-the-taiwan_village_sf." class="nav-link" data-scroll-target="#filtering-the-taiwan_village_sf.">2.1.2 Filtering the taiwan_village_sf.</a></li>
  <li><a href="#saving-it-to-rds" id="toc-saving-it-to-rds" class="nav-link" data-scroll-target="#saving-it-to-rds">2.1.3 Saving it to RDS</a></li>
  <li><a href="#visualise-the-dataset-by-plotting-it" id="toc-visualise-the-dataset-by-plotting-it" class="nav-link" data-scroll-target="#visualise-the-dataset-by-plotting-it">2.1.4 Visualise the dataset by plotting it</a></li>
  </ul></li>
  <li><a href="#dengue-data-dengue_sf" id="toc-dengue-data-dengue_sf" class="nav-link" data-scroll-target="#dengue-data-dengue_sf">2.2 Dengue Data (dengue_sf)</a>
  <ul class="collapse">
  <li><a href="#import-the-csv-data-dengue_daily.csv" id="toc-import-the-csv-data-dengue_daily.csv" class="nav-link" data-scroll-target="#import-the-csv-data-dengue_daily.csv">2.2.1 Import the csv data (Dengue_Daily.csv)</a></li>
  <li><a href="#filtering-the-dengue_sf" id="toc-filtering-the-dengue_sf" class="nav-link" data-scroll-target="#filtering-the-dengue_sf">2.2.2 Filtering the dengue_sf</a></li>
  <li><a href="#basic-analysis-of-filtered_dengue_sf-dataset" id="toc-basic-analysis-of-filtered_dengue_sf-dataset" class="nav-link" data-scroll-target="#basic-analysis-of-filtered_dengue_sf-dataset">2.2.3 Basic Analysis of filtered_dengue_sf dataset</a></li>
  <li><a href="#saving-it-to-rds-1" id="toc-saving-it-to-rds-1" class="nav-link" data-scroll-target="#saving-it-to-rds-1">2.2.4 Saving it to RDS</a></li>
  </ul></li>
  <li><a href="#performing-join-operation-to-combine-both-data-sets" id="toc-performing-join-operation-to-combine-both-data-sets" class="nav-link" data-scroll-target="#performing-join-operation-to-combine-both-data-sets">2.3 Performing Join operation to combine both data sets</a>
  <ul class="collapse">
  <li><a href="#join-operation-and-outcome" id="toc-join-operation-and-outcome" class="nav-link" data-scroll-target="#join-operation-and-outcome">2.3.1 Join Operation and Outcome</a></li>
  <li><a href="#saving-it-to-rds-2" id="toc-saving-it-to-rds-2" class="nav-link" data-scroll-target="#saving-it-to-rds-2">2.3.2 Saving it to RDS</a></li>
  </ul></li>
  <li><a href="#creating-time-series-cube-spacetime-for-dengue-cases" id="toc-creating-time-series-cube-spacetime-for-dengue-cases" class="nav-link" data-scroll-target="#creating-time-series-cube-spacetime-for-dengue-cases">2.4 Creating <strong>Time Series Cube (spacetime) for dengue cases</strong></a>
  <ul class="collapse">
  <li><a href="#create-2-dataframes-to-store-both-taiwan_village_dengue-and-filtered_taiwan_village_sf-datasets" id="toc-create-2-dataframes-to-store-both-taiwan_village_dengue-and-filtered_taiwan_village_sf-datasets" class="nav-link" data-scroll-target="#create-2-dataframes-to-store-both-taiwan_village_dengue-and-filtered_taiwan_village_sf-datasets">2.4.1 Create 2 dataframes to store both taiwan_village_dengue and filtered_taiwan_village_sf datasets</a></li>
  <li><a href="#data-preparation-for-cases_village-dataset" id="toc-data-preparation-for-cases_village-dataset" class="nav-link" data-scroll-target="#data-preparation-for-cases_village-dataset">2.4.2 Data Preparation for cases_village dataset</a></li>
  <li><a href="#spacetime-operation" id="toc-spacetime-operation" class="nav-link" data-scroll-target="#spacetime-operation">2.4.3 Spacetime Operation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#global-spatial-autocorrelation-analysis-by-using-sfdep-methods" id="toc-global-spatial-autocorrelation-analysis-by-using-sfdep-methods" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-analysis-by-using-sfdep-methods">3 Global Spatial Autocorrelation Analysis by using sfdep methods</a>
  <ul>
  <li><a href="#visualizing-taiwan_village_dengue" id="toc-visualizing-taiwan_village_dengue" class="nav-link" data-scroll-target="#visualizing-taiwan_village_dengue">3.1 Visualizing taiwan_village_dengue</a></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">3.2 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">3.2.1 Computing Contiguity Spatial Weights</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation-morans-i" id="toc-global-measures-of-spatial-autocorrelation-morans-i" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation-morans-i">3.3 Global Measures of Spatial Autocorrelation: Moran’s I</a>
  <ul class="collapse">
  <li><a href="#compute-global-morans-i" id="toc-compute-global-morans-i" class="nav-link" data-scroll-target="#compute-global-morans-i">3.3.1 Compute Global Moran’s I</a></li>
  <li><a href="#global-morans-i-test" id="toc-global-morans-i-test" class="nav-link" data-scroll-target="#global-morans-i-test">3.3.2 Global Moran’s I Test</a></li>
  <li><a href="#computing-global-monte-carlo-morans-i" id="toc-computing-global-monte-carlo-morans-i" class="nav-link" data-scroll-target="#computing-global-monte-carlo-morans-i">3.3.3 Computing Global Monte Carlo Moran’s I</a></li>
  <li><a href="#visualising-global-monte-carlo-morans-i" id="toc-visualising-global-monte-carlo-morans-i" class="nav-link" data-scroll-target="#visualising-global-monte-carlo-morans-i">3.3.4 Visualising Global Monte Carlo Moran’s I</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#local-spatial-autocorrelation-analysis-by-using-sfdep-methods" id="toc-local-spatial-autocorrelation-analysis-by-using-sfdep-methods" class="nav-link" data-scroll-target="#local-spatial-autocorrelation-analysis-by-using-sfdep-methods">4 Local Spatial Autocorrelation Analysis by using sfdep methods</a>
  <ul>
  <li><a href="#compute-local-morans-i" id="toc-compute-local-morans-i" class="nav-link" data-scroll-target="#compute-local-morans-i">4.1 Compute Local Moran’s I</a></li>
  <li><a href="#visualising-local-morans-i-and-p-value" id="toc-visualising-local-morans-i-and-p-value" class="nav-link" data-scroll-target="#visualising-local-morans-i-and-p-value">4.2 Visualising local Moran’s I and p-value</a></li>
  <li><a href="#visualising-lisa-map" id="toc-visualising-lisa-map" class="nav-link" data-scroll-target="#visualising-lisa-map">4.3 <strong>Visualising LISA map</strong></a></li>
  <li><a href="#conclusion-for-local-spatial-autocorrelation" id="toc-conclusion-for-local-spatial-autocorrelation" class="nav-link" data-scroll-target="#conclusion-for-local-spatial-autocorrelation">4.4 Conclusion for Local Spatial Autocorrelation</a></li>
  </ul></li>
  <li><a href="#hotspot-analysis-by-using-sfdep-methods" id="toc-hotspot-analysis-by-using-sfdep-methods" class="nav-link" data-scroll-target="#hotspot-analysis-by-using-sfdep-methods">5 Hotspot Analysis by using sfdep methods</a>
  <ul>
  <li><a href="#performing-hot-spot-and-cold-spot-area-analysis-hcsa" id="toc-performing-hot-spot-and-cold-spot-area-analysis-hcsa" class="nav-link" data-scroll-target="#performing-hot-spot-and-cold-spot-area-analysis-hcsa">5.1 Performing Hot Spot and Cold Spot Area Analysis (HCSA)</a>
  <ul class="collapse">
  <li><a href="#computing-spatial-weights" id="toc-computing-spatial-weights" class="nav-link" data-scroll-target="#computing-spatial-weights">5.1.1 Computing spatial weights</a></li>
  <li><a href="#computing-local-gi-statistics" id="toc-computing-local-gi-statistics" class="nav-link" data-scroll-target="#computing-local-gi-statistics">5.1.2 Computing local Gi* statistics</a></li>
  <li><a href="#visualising-gi" id="toc-visualising-gi" class="nav-link" data-scroll-target="#visualising-gi">5.1.3 Visualising Gi*</a></li>
  <li><a href="#visualising-p-value-of-hcsa" id="toc-visualising-p-value-of-hcsa" class="nav-link" data-scroll-target="#visualising-p-value-of-hcsa"><strong>5.1.4 Visualising p-value of HCSA</strong></a></li>
  <li><a href="#visualising-local-hcsa" id="toc-visualising-local-hcsa" class="nav-link" data-scroll-target="#visualising-local-hcsa"><strong>5.1.5 Visualising Local HCSA</strong></a></li>
  <li><a href="#visualising-hot-spot-and-cold-spot-areas" id="toc-visualising-hot-spot-and-cold-spot-areas" class="nav-link" data-scroll-target="#visualising-hot-spot-and-cold-spot-areas"><strong>5.1.6 Visualising hot spot and cold spot areas</strong></a></li>
  </ul></li>
  <li><a href="#analysing-emerging-hotspot" id="toc-analysing-emerging-hotspot" class="nav-link" data-scroll-target="#analysing-emerging-hotspot">5.2 Analysing Emerging Hotspot</a>
  <ul class="collapse">
  <li><a href="#computing-gi" id="toc-computing-gi" class="nav-link" data-scroll-target="#computing-gi">5.2.1 Computing Gi*</a></li>
  <li><a href="#computing-local-gi" id="toc-computing-local-gi" class="nav-link" data-scroll-target="#computing-local-gi">5.2.2 Computing Local Gi*</a></li>
  <li><a href="#computing-mann-kendall-test" id="toc-computing-mann-kendall-test" class="nav-link" data-scroll-target="#computing-mann-kendall-test">5.2.3 Computing Mann-Kendall Test</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">6 Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gerald Lim </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setting-the-scene" class="level2">
<h2 class="anchored" data-anchor-id="setting-the-scene"><strong>Setting the Scene</strong></h2>
<p>The surge in dengue fever cases in Taiwan during 2023 marks a concerning deviation from the relatively stable trend observed in previous years. Despite efforts to control the disease, the drastic increase to over 26,000 cases highlights potential challenges in disease management and prevention strategies. Tainan City emerges as a focal point, bearing the brunt of this outbreak with a significant concentration of reported cases, emphasizing the need for targeted interventions and heightened vigilance in affected regions.</p>
<p><img src="images/clipboard-3174463590.png" class="img-fluid" width="511"></p>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives"><strong>Objectives</strong></h2>
<p>In this geospatial analytics research, our goal is to discover:</p>
<ul>
<li><p>If the distribution of dengue fever outbreak at Tainan City, Taiwan are independent from space and time.</p></li>
<li><p>If the outbreak is indeed spatial and spatio-temporal dependent</p></li>
<li><p>where are the clusters and outliers, and the emerging hot spot/cold spot areas.</p></li>
</ul>
</section>
<section id="install-maptools" class="level2">
<h2 class="anchored" data-anchor-id="install-maptools">1 Install maptools</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"maptools"</span>, <span class="at">repos =</span> <span class="st">"https://packagemanager.posit.co/cran/2023-10-13"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Installing the required tools for the analysis (e.g.&nbsp;sf, tidyverse, maptools, etc)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(maptools, sf, raster, spatstat, tmap, tidyverse, arrow, lubridate, dplyr, spNetwork, spacetime, spdep, sfdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-import-wrangling-and-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-import-wrangling-and-analysis">2 Data Import, Wrangling and Analysis</h2>
<p>This is where we import the data and prepare it before analysis.</p>
<p>Let’s use st_read() of sf package to import these two geospatial data sets into R. And we will be using other functions to prepare our data upon importing them. Moreover, we will also perform some simple operation on the datasets to gather some basic analysis.</p>
<p>The 2 data sets are:</p>
<ul>
<li><p>TAIWAN_VILLAGE_2020, a geospatial data of village boundary of Taiwan. It is in ESRI shapefile format. The data is in Taiwan Geographic Coordinate System. (Source: <a href="https://data.gov.tw/en/datasets/130549">Historical map data of the village boundary: TWD97 longitude and latitude</a>)</p></li>
<li><p>Dengue_Daily.csv, an aspatial data of reported dengue cases in Taiwan since 1998. (Source: <a href="https://data.cdc.gov.tw/en/dataset/dengue-daily-determined-cases-1998">Dengue Daily Confirmed Cases Since 1998</a>. Below are selected fields that are useful for this study:</p>
<ul>
<li><p>發病日: Onset date</p></li>
<li><p>最小統計區中心點X: x-coordinate</p></li>
<li><p>最小統計區中心點Y: y-coordinate</p></li>
</ul></li>
</ul>
<section id="taiwan-village-data-taiwan_village_sf" class="level3">
<h3 class="anchored" data-anchor-id="taiwan-village-data-taiwan_village_sf">2.1 Taiwan Village Data (taiwan_village_sf)</h3>
<section id="import-the-csv-data-tainan_village.shp" class="level4">
<h4 class="anchored" data-anchor-id="import-the-csv-data-tainan_village.shp">2.1.1 Import the csv data (TAINAN_VILLAGE.shp)</h4>
<p>Firstly, we will import the data for the Taiwan Village Data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>taiwan_village_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"TAINAN_VILLAGE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s check the referencing system info of this taiwan_village_sf</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(taiwan_village_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtering-the-taiwan_village_sf." class="level4">
<h4 class="anchored" data-anchor-id="filtering-the-taiwan_village_sf.">2.1.2 Filtering the taiwan_village_sf.</h4>
<p>Currently, we have 649 rows of data in taiwan_village_sf.</p>
<p><img src="images/clipboard-933829746.png" class="img-fluid"></p>
<p>Therefore, we have to filter the taiwan_village_sf for village level of D01, D02, D04, D06, D07, D08, D32, and D39 of the Tainan City, Taiwan</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#taiwan_village_sf &lt;- st_transform(taiwan_village_sf, CRS=3414) - not needed</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#filter the specific town ID from taiwan_village_sf</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>filtered_taiwan_village_sf <span class="ot">&lt;-</span> taiwan_village_sf <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOWNID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"D01"</span>, <span class="st">"D02"</span>, <span class="st">"D04"</span>, <span class="st">"D06"</span>, <span class="st">"D07"</span>, <span class="st">"D08"</span>, <span class="st">"D32"</span>, <span class="st">"D39"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, filtered_taiwan_village_sf will consist of 258 rows of data. This will help to reduce the amount of data that is needed to be processed in the later parts.</p>
<p><img src="images/clipboard-1325127262.png" class="img-fluid"></p>
</section>
<section id="saving-it-to-rds" class="level4">
<h4 class="anchored" data-anchor-id="saving-it-to-rds">2.1.3 Saving it to RDS</h4>
<p>Since we’re happy with the dataset for filtered_taiwan_village_sf, let’s save it to a rds so that it would be easier for us to retrieve it in the future</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(filtered_taiwan_village_sf, <span class="st">"data/rds/filtered_taiwan_village_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import the filtered_taiwan_village_sf rds data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>filtered_taiwan_village_sf <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/filtered_taiwan_village_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualise-the-dataset-by-plotting-it" class="level4">
<h4 class="anchored" data-anchor-id="visualise-the-dataset-by-plotting-it">2.1.4 Visualise the dataset by plotting it</h4>
<p>Let’s visualise how filtered_taiwan_village_sf looks like when we plot it</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(filtered_taiwan_village_sf) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="dengue-data-dengue_sf" class="level3">
<h3 class="anchored" data-anchor-id="dengue-data-dengue_sf">2.2 Dengue Data (dengue_sf)</h3>
<section id="import-the-csv-data-dengue_daily.csv" class="level4">
<h4 class="anchored" data-anchor-id="import-the-csv-data-dengue_daily.csv">2.2.1 Import the csv data (Dengue_Daily.csv)</h4>
<p>Firstly, we will import the data for the Dengue Data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dengue_sf <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/Dengue_Daily.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As dengue_sf consists of 106861 rows of data, with 26 types of variables, as shown below. Therefore we need to filter it</p>
<p><img src="images/clipboard-342559558.png" class="img-fluid"></p>
</section>
<section id="filtering-the-dengue_sf" class="level4">
<h4 class="anchored" data-anchor-id="filtering-the-dengue_sf">2.2.2 Filtering the dengue_sf</h4>
<p>Let’s filter dengue_sf for fever cases that are confined to epidemiology week 31-50 of 2023, as well as the selected variables which we will be working with (發病日: Onset date, 居住縣市: County, 居住鄉鎮: Town, 居住村里: Village, 最小統計區中心點X: x-coordinate, 最小統計區中心點Y: y-coordinate)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataset for fever cases confined to epidemiology week 31-50, 2023</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf <span class="ot">&lt;-</span> dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(發病日 <span class="sc">&gt;=</span> <span class="st">"2023-07-31"</span> <span class="sc">&amp;</span> 發病日 <span class="sc">&lt;=</span> <span class="st">"2023-12-17"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(發病日, 居住縣市, 居住鄉鎮, 居住村里, 最小統計區中心點X, 最小統計區中心點Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the code chunk above, we filtered the specific data that falls under the weeks that we are interested to look into. Moreover, we also use the “select” line to select the specific variables that we deemed useful for our research.</p>
<p>After filtering dengue_sf, and storing it in filtered_dengue_sf, the amount of data has reduced significantly from 106861 rows of data in dengue_sf, to 25480 rows of data in filtered_dengue_sf (with 3 types of variables).</p>
<p><img src="images/clipboard-1392265263.png" class="img-fluid"></p>
<p>Let’s check the data type of each variable before we proceed to performing left-join</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(filtered_dengue_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s transform some of our variables and prepare it for the left-join operation in step 2.3</p>
<ul>
<li>Since the X and Y coordinates are in string format, we need to convert it to numeric.</li>
<li>This is the same for onset date where we need to convert it to date format</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the columns to numeric</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>發病日 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(filtered_dengue_sf<span class="sc">$</span>發病日)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>最小統計區中心點X <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(filtered_dengue_sf<span class="sc">$</span>最小統計區中心點X)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>最小統計區中心點Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(filtered_dengue_sf<span class="sc">$</span>最小統計區中心點Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s create 3 different variables that stores the week number, month and day respectively. This is to facilitate our research and analysis in the later parts of this take-home exercise.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract week number, month, and day separately</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>epi_week_num <span class="ot">&lt;-</span> <span class="fu">format</span>(filtered_dengue_sf<span class="sc">$</span>發病日, <span class="st">"%U"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">format</span>(filtered_dengue_sf<span class="sc">$</span>發病日, <span class="st">"%m"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">format</span>(filtered_dengue_sf<span class="sc">$</span>發病日, <span class="st">"%d"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#convert epi_week_num to numeric (for use in future steps)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf<span class="sc">$</span>epi_week_num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(filtered_dengue_sf<span class="sc">$</span>epi_week_num)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#order it by week num</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf <span class="ot">&lt;-</span> filtered_dengue_sf[<span class="fu">order</span>(filtered_dengue_sf<span class="sc">$</span>epi_week_num), ]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#rename 居住村里 to VILLNAME</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">VILLNAME =</span> 居住村里)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the modified dataset</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtered_dengue_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>However, in our dengue dataset, we have noticed that there are rows of data with no village name. As our research is focused mainly on the village level, we will remove the rows with village name = “None”. [SKIP FIRST]</p>
<p><img src="images/clipboard-459349656.png" class="img-fluid" width="612"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with village name = "None"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>filtered_dengue_sf <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VILLNAME <span class="sc">!=</span> <span class="st">"None"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="basic-analysis-of-filtered_dengue_sf-dataset" class="level4">
<h4 class="anchored" data-anchor-id="basic-analysis-of-filtered_dengue_sf-dataset">2.2.3 Basic Analysis of filtered_dengue_sf dataset</h4>
<p>Since we have the finalised filtered_dengue_sf, it is important for us to create a new table to store the number of cases, grouped by the <strong>day</strong> and <strong>village</strong>. We will store it in cases_by_day_village dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Group by day and village, then count the number of cases</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cases_by_day_village <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(發病日, VILLNAME, 最小統計區中心點X, 最小統計區中心點Y) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_cases =</span> <span class="fu">n</span>())</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Optionally, you can rename the columns for clarity</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cases_by_day_village) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"Village"</span>, <span class="st">"XCoordinate"</span>, <span class="st">"YCoordinate"</span>, <span class="st">"Num_Cases"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: View the resulting dataframe</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cases_by_day_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A snippet of the resulting dataset for <strong>cases_by_day_village</strong> looks like this:</p>
<p><img src="images/clipboard-3333388626.png" class="img-fluid" width="450"></p>
<p>In addition to the cases_by_day_village dataset, it would be useful for us to create a new table to store the total number of cases, grouped by the <strong>week</strong> and <strong>village</strong>. We will store it in <strong>cases_by_week_village</strong> dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Group by week and village, then count the number of cases and retain X and Y coordinates</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cases_by_week_village <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(epi_week_num, VILLNAME) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Num_Cases =</span> <span class="fu">n</span>(),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">XCoordinate =</span> <span class="fu">mean</span>(最小統計區中心點X),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">YCoordinate =</span> <span class="fu">mean</span>(最小統計區中心點Y))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Optionally, you can rename the columns for clarity</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cases_by_week_village) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"epi_week_num"</span>, <span class="st">"Village"</span>, <span class="st">"Num_Cases"</span>, <span class="st">"XCoordinate"</span>, <span class="st">"YCoordinate"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: View the resulting dataframe</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cases_by_week_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A snippet of the resulting dataset for <strong>cases_by_week_village</strong> looks like this:</p>
<ul>
<li>We kept the X and Y coordinates so that we can convert it into a spatial dataset in the future.</li>
</ul>
<p><img src="images/clipboard-1288846011.png" class="img-fluid"></p>
<p>To get the number of cases in througout Tainan city during the whole epidemiology week 31-50, it would be useful for us to create a new table to store the number of cases for each village. We will store it in <strong>cases_by_village</strong> dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Group by day and village, then count the number of cases</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cases_by_village  <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VILLNAME, 最小統計區中心點X, 最小統計區中心點Y) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_cases =</span> <span class="fu">n</span>())</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Optionally, you can rename the columns for clarity</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cases_by_village) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"village"</span>, <span class="st">"XCoordinate"</span>, <span class="st">"YCoordinate"</span>, <span class="st">"Num_Cases"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: View the resulting dataframe</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cases_by_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A snippet of the resulting dataset for <strong>cases_by_village</strong> looks like this:</p>
<p><img src="images/clipboard-483203027.png" class="img-fluid" width="433"></p>
<p>To get the number of cases in a week througout Tainan city, it would be useful for us to create a new table to store the number of cases, grouped by the <strong>week</strong> alone. We will store it in <strong>cases_by_week</strong> dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Group by day and village, then count the number of cases</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cases_by_week  <span class="ot">&lt;-</span> filtered_dengue_sf <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(epi_week_num) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_cases =</span> <span class="fu">n</span>())</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Optionally, you can rename the columns for clarity</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cases_by_week) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"epi_week_num"</span>, <span class="st">"Num_Cases"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: View the resulting dataframe</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cases_by_week)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A snippet of the resulting dataset for <strong>cases_by_week</strong> looks like this:</p>
<p><img src="images/clipboard-941645063.png" class="img-fluid"></p>
<p>Now, we have found valuable analysis from our dataset, let’s move on to the next section where we keep them in rds form.</p>
</section>
<section id="saving-it-to-rds-1" class="level4">
<h4 class="anchored" data-anchor-id="saving-it-to-rds-1">2.2.4 Saving it to RDS</h4>
<p>Since we’re happy with the dataset for filtered_taiwan_village_sf, and datasets from our analysis in 2.2.3, let’s save it to a rds so that it would be easier for us to retrieve it in the future</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(filtered_dengue_sf, <span class="st">"data/rds/filtered_dengue_sf.rds"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(cases_by_day_village, <span class="st">"data/rds/cases_by_day_village.rds"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(cases_by_week_village, <span class="st">"data/rds/cases_by_week_village.rds"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(cases_by_week, <span class="st">"data/rds/cases_by_week.rds"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(cases_by_village, <span class="st">"data/rds/cases_by_village.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import the filtered_taiwan_village_sf rds data</p>
<p>Let’s take a look at our Dengue datasets in 2.2 before we move on to 2.3 :)</p>
<p><strong>filtered_dengue_sf</strong></p>
<ul>
<li>I have included the 居住縣市 (County), 居住鄉鎮 (Town) and 居住村里 (Village) into the data set for easier future reference.</li>
</ul>
<p><img src="images/clipboard-2567583851.png" class="img-fluid" width="829"></p>
</section>
</section>
<section id="performing-join-operation-to-combine-both-data-sets" class="level3">
<h3 class="anchored" data-anchor-id="performing-join-operation-to-combine-both-data-sets">2.3 Performing Join operation to combine both data sets</h3>
<p>Let’s perform a join operation to combine the variables in filtered_taiwan_village_sf and filtered_dengue_sf.</p>
<p>Our goal is to perform the join operation to the <strong>cases_by_week_village</strong> and supplement it with the specific geospatial and relevant variable. We will be operating the join operation based on the Village Name of both dataset as we want to retrieve the distinct geospatial infromation from <strong>filtered_taiwan_village_sf</strong> for each dengue cases.</p>
<p>The reason for using cases_by_week_village is because we are focusing on the number of cases in each village on a weekly basis.</p>
<section id="join-operation-and-outcome" class="level4">
<h4 class="anchored" data-anchor-id="join-operation-and-outcome">2.3.1 Join Operation and Outcome</h4>
<p>Before we perform the join operation, we can see that the cases_by_village is not a spatial data. As for filtered_taiwan_village_sf, we have already checked the data type of the file is already in spatial data type (TWD97).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(cases_by_week_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System: NA</code></pre>
</div>
</div>
<p>Therefore we have to convert the cases_by_week_village dataset into a spatial data.</p>
<p>Before we transform it into a spatial data, we have to vet through our data in cases_by_week_village dataset. There are rows where there are “NA” values for the village name, X and Y coordinates, which could potentially cause issues in the future analysis.</p>
<p><img src="images/clipboard-977836271.png" class="img-fluid"></p>
<p>And we have to clean up the NA values before proceeding to cases_by_week_village into a spatial data.</p>
<p>One option that we could remove the NA values which could potentially create problems in our future analysis, and they wouldn’t provide us with accurate analysis. On the other hand, if we were to adopt the other option which is to find the mean / median of the x and y coordinates for the missing values, it would also affect the accuracy of our analysis.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert cases_by_village to sf object</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cases_by_week_village <span class="ot">&lt;-</span> cases_by_week_village[<span class="fu">complete.cases</span>(cases_by_week_village[, <span class="fu">c</span>(<span class="st">"XCoordinate"</span>, <span class="st">"YCoordinate"</span>)]), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that we have cleared the NA values, let’s transform the case_by_village dataset into a sf</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cases_by_week_village_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(cases_by_week_village, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"XCoordinate"</span>, <span class="st">"YCoordinate"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(cases_by_week_village_sf) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s transform our case_by_village dataset into a spatial dataset (in sf)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cases_by_week_village_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(cases_by_week_village_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(filtered_taiwan_village_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The join dataset would be named taiwan_village_dengue</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform spatial join</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>taiwan_village_dengue <span class="ot">&lt;-</span> <span class="fu">st_join</span>(filtered_taiwan_village_sf, cases_by_week_village_sf, <span class="at">join =</span> st_intersects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After performing the left-join operation, the taiwan_village_dengue dataset seems to have “NA” values. This is due to the fact that the village name (居住村里) value in the filtered_dengue_sf is not found in the list of village name (VILLNAME) in filtered_taiwan_village_sf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(taiwan_village_dengue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: TWD97 
  wkt:
GEOGCRS["TWD97",
    DATUM["Taiwan Datum 1997",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["Taiwan, Republic of China - onshore and offshore - Taiwan Island, Penghu (Pescadores) Islands."],
        BBOX[17.36,114.32,26.96,123.61]],
    ID["EPSG",3824]]</code></pre>
</div>
</div>
<p>Let’s take a look at our newly joined dataset.</p>
<p><img src="images/clipboard-291429429.png" class="img-fluid"></p>
<p>We have noticed that there are “NA” values in the Num_Cases column of the newly joined dateset.</p>
<p><img src="images/clipboard-49182639.png" class="img-fluid" width="464"></p>
<p>So, we have to remove it before going to the next step. We will remove the rows with has “NA” values in the epi_week_num column.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>taiwan_village_dengue <span class="ot">&lt;-</span> taiwan_village_dengue[<span class="sc">!</span><span class="fu">is.na</span>(taiwan_village_dengue<span class="sc">$</span>Num_Cases), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="saving-it-to-rds-2" class="level4">
<h4 class="anchored" data-anchor-id="saving-it-to-rds-2">2.3.2 Saving it to RDS</h4>
<p>Since we are happy with our finalised taiwan_village_dengue dataset, let’s keep it in our rds for easy reference in the future</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(taiwan_village_dengue, <span class="st">"data/rds/taiwan_village_dengue.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import the filtered_taiwan_village_sf rds data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>taiwan_village_dengue <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/taiwan_village_dengue.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s take a look at our taiwan_village_dengue dataset :)</p>
<p><img src="images/clipboard-1066673433.png" class="img-fluid"></p>
<p>Let’s plot <strong>taiwan_village_dengue</strong> and see how it looks like.</p>
<p>We will create an “<strong>total_cases_by_village</strong>” dataset to count the number of cases in each village, and thereafter plot it on tmap, so that we can easily identify which village has a higher number of cases on the map.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the data to get the total number of cases for each village</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>total_cases_by_village <span class="ot">&lt;-</span> taiwan_village_dengue <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VILLNAME) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Num_Cases =</span> <span class="fu">sum</span>(Num_Cases))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the total number of cases using tmap</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(total_cases_by_village) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Total_Num_Cases"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Total Number of Cases"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of dengue cases in Tainan City"</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the map, we can see that there are some villages that have a significantly higher number of cases. If we look at our <strong>total_cases_by_village</strong> dataset, we can see that these are the villages with the highest number of cases.</p>
</section>
</section>
<section id="creating-time-series-cube-spacetime-for-dengue-cases" class="level3">
<h3 class="anchored" data-anchor-id="creating-time-series-cube-spacetime-for-dengue-cases">2.4 Creating <strong>Time Series Cube (spacetime) for dengue cases</strong></h3>
<p>In this section, we will create the a spatio-temporal cube for our dengue cases (<strong>dengue_st</strong>).</p>
<p>We will be using taiwan_village_dengue and filtered_taiwan_village_sf to create our spacetime data.</p>
<section id="create-2-dataframes-to-store-both-taiwan_village_dengue-and-filtered_taiwan_village_sf-datasets" class="level4">
<h4 class="anchored" data-anchor-id="create-2-dataframes-to-store-both-taiwan_village_dengue-and-filtered_taiwan_village_sf-datasets">2.4.1 Create 2 dataframes to store both taiwan_village_dengue and filtered_taiwan_village_sf datasets</h4>
<p>We have to create new dataframes to store both datasets so that the original datasets won’t be overwritten.</p>
<p>Firstly, we duplicate taiwan_village_dengue into cases_dengue, and filtered_taiwan_village_sf into filtered_taiwan_village_sf_filtered</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cases_village <span class="ot">&lt;-</span> taiwan_village_dengue</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>filtered_taiwan_village_sf_filtered <span class="ot">&lt;-</span> filtered_taiwan_village_sf </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s check for the number of unique villages.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming your dataset is called cases_village and the village column is named VILLNAME</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>unique_villages <span class="ot">&lt;-</span> <span class="fu">unique</span>(cases_village<span class="sc">$</span>VILLNAME)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>num_unique_villages <span class="ot">&lt;-</span> <span class="fu">length</span>(unique_villages)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of unique villages</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_villages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225</code></pre>
</div>
</div>
<p>Since we have 228 unique villages, we are expecting to create a spacetime data (dengue_st) with 228 x 21 = 4788 rows.</p>
</section>
<section id="data-preparation-for-cases_village-dataset" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-for-cases_village-dataset">2.4.2 Data Preparation for cases_village dataset</h4>
<p>Let’s check the data type of cases_village dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cases_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
</div>
<p>As cases_village is still in sf format, we want to convert it into a df, as we are using it as a df for our spacetime operation.</p>
<p>We will also filter the “VILLNAME”, “epi_week_num” and “Num_Cases” columns which we will be using for the operation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the spatial data to a data frame</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cases_village_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cases_village)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the geometry column</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>cases_village_df <span class="ot">&lt;-</span> cases_village_df[, <span class="sc">!</span>(<span class="fu">names</span>(cases_village_df) <span class="sc">%in%</span> <span class="st">"geometry"</span>)]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the columns you want to keep</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>cases_village_df <span class="ot">&lt;-</span> cases_village_df[, <span class="fu">c</span>(<span class="st">"VILLNAME"</span>, <span class="st">"epi_week_num"</span>, <span class="st">"Num_Cases"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We need to convert “epi_week_num” into integer type for the spacetime operation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert epi_week_num to integer in cases_village_df</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cases_village_df<span class="sc">$</span>epi_week_num <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(cases_village_df<span class="sc">$</span>epi_week_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We need to remove the duplicate rows in our cases_village_df dataset as it would affect our spacetime operation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify duplicate rows based on selected columns</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>duplicate_rows <span class="ot">&lt;-</span> cases_village_df[<span class="fu">duplicated</span>(cases_village_df[, <span class="fu">c</span>(<span class="st">"VILLNAME"</span>, <span class="st">"epi_week_num"</span>)]), ]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicate rows from cases_village_df</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>cases_village_df <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cases_village_df, duplicate_rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looking at our cases_village_df dataset, we noticed that there are missing rows as 0 cases are not recorded in the dataset. So, we will amend the dataset and add the rows for the respective village (and week) with 0 for weeks where there is no records.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complete dataset with all combinations of village names and week numbers</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>complete_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">VILLNAME =</span> <span class="fu">unique</span>(cases_village_df<span class="sc">$</span>VILLNAME),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">epi_week_num =</span> <span class="fu">unique</span>(cases_village_df<span class="sc">$</span>epi_week_num))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join with cases_village_df to fill in missing combinations</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>cases_village_df <span class="ot">&lt;-</span> complete_data <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cases_village_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VILLNAME"</span>, <span class="st">"epi_week_num"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Num_Cases =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Num_Cases), <span class="dv">0</span>, Num_Cases))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the dimensions of complete_data</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cases_village_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4725    3</code></pre>
</div>
</div>
<p>Let’s double check our epi_week_num data type. Make sure it is an integer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cases_village_df<span class="sc">$</span>epi_week_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>Let’s double check our VILLNAME data type. Make sure it is an character.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cases_village_df<span class="sc">$</span>VILLNAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Now, we will filter filtered_taiwan_village_sf_filtered and keep the rows that has the same villages in cases_village_df.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique village names from cases_village_df</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>unique_villages_cases <span class="ot">&lt;-</span> <span class="fu">unique</span>(cases_village_df<span class="sc">$</span>VILLNAME)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter filtered_taiwan_village_sf_filtered to include only villages present in cases_village_df</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>filtered_taiwan_village_sf_filtered <span class="ot">&lt;-</span> filtered_taiwan_village_sf_filtered[filtered_taiwan_village_sf_filtered<span class="sc">$</span>VILLNAME <span class="sc">%in%</span> unique_villages_cases, ]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of unique villages in filtered_taiwan_village_sf_filtered</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(<span class="fu">unique</span>(filtered_taiwan_village_sf_filtered<span class="sc">$</span>VILLNAME)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of unique locations in filtered_taiwan_village_sf</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>num_unique_locations_filtered_taiwan_village_sf <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(filtered_taiwan_village_sf_filtered))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_locations_filtered_taiwan_village_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 230</code></pre>
</div>
</div>
<p>As we can see that filtered_taiwan_village_sf_filtered has a total 233 rows, but with 228 unique village name (VILLNAME), which indicates that there is duplicated villages in the dataset. We need to remove the duplicated rows.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicate village names</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>filtered_taiwan_village_sf_filtered <span class="ot">&lt;-</span> filtered_taiwan_village_sf_filtered[<span class="sc">!</span><span class="fu">duplicated</span>(filtered_taiwan_village_sf_filtered<span class="sc">$</span>VILLNAME), ]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of unique locations after removing duplicates</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>num_unique_locations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(filtered_taiwan_village_sf_filtered<span class="sc">$</span>VILLNAME))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_locations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>Now, after removing the duplicated rows, let’s check to make sure both datasets has 228 rows of data before we do the spacetime operation</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of unique locations in filtered_cases_village</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>num_unique_locations_filtered_cases_village <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(cases_village_df<span class="sc">$</span>VILLNAME))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_locations_filtered_cases_village)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of unique locations in filtered_taiwan_village_sf</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>num_unique_locations_filtered_taiwan_village_sf <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(filtered_taiwan_village_sf_filtered))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_locations_filtered_taiwan_village_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225</code></pre>
</div>
</div>
</section>
<section id="spacetime-operation" class="level4">
<h4 class="anchored" data-anchor-id="spacetime-operation">2.4.3 Spacetime Operation</h4>
<p>Let’s perform the spacetime operation, by setting the VILLNAME as .loc_col, and epi_week_num as .time_col.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine spatial and temporal data</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>dengue_st <span class="ot">&lt;-</span> <span class="fu">spacetime</span>(cases_village_df, filtered_taiwan_village_sf_filtered,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.loc_col =</span> <span class="st">"VILLNAME"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.time_col =</span> <span class="st">"epi_week_num"</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the spacetime object</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>dengue_st</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The results for the spacetime operation is too long, so let’s see a shorten version</p>
<p><img src="images/clipboard-1994988612.png" class="img-fluid" width="322"></p>
<p>A snippet of how the newly created dengue_st would look like</p>
<p><img src="images/clipboard-2023401532.png" class="img-fluid" width="404"></p>
<p>It looks like the cases_village_df, while the spacial data (geometry) is also included in the dataset, but it is not seen.</p>
<p>Let’s check the number of rows and columns for our newly created dengue_st</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dengue_st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4725    3</code></pre>
</div>
</div>
<p>Let’s check if dengue_st is truly a spacetime_cube</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(dengue_st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We will save dengue_st for Analysing Emerging Hotspot in 5.2.</p>
</section>
</section>
</section>
<section id="global-spatial-autocorrelation-analysis-by-using-sfdep-methods" class="level2">
<h2 class="anchored" data-anchor-id="global-spatial-autocorrelation-analysis-by-using-sfdep-methods">3 Global Spatial Autocorrelation Analysis by using sfdep methods</h2>
<section id="visualizing-taiwan_village_dengue" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-taiwan_village_dengue">3.1 Visualizing taiwan_village_dengue</h3>
<p>Let’s visualize taiwan_village_dengue before we move on to performing global spatial autocorrelation analysis</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(taiwan_village_dengue) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"Num_Cases"</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal interval classification"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(taiwan_village_dengue) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"Num_Cases"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal quantile classification"</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(equal, </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>             quantile, </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation">3.2 Global Measures of Spatial Autocorrelation</h3>
<p>We will be performing Global Measures of Spatial Autocorrelation in this section.</p>
<section id="computing-contiguity-spatial-weights" class="level4">
<h4 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">3.2.1 Computing Contiguity Spatial Weights</h4>
<p>Before we can perform the global spatial autocorrelation analysis, we need to construct the spatial weights of the study area. The spatial weights is used to define the neighbourhood relationships between the geographical units.</p>
<p>We have to prepare our dataset before computing the spatial weights</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert geometry to simple feature collection</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>taiwan_village_dengue_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(taiwan_village_dengue)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find neighboring features (e.g., using contiguity)</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>neighbors <span class="ot">&lt;-</span> <span class="fu">st_touches</span>(taiwan_village_dengue_sf)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spatial weights</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>spatial_weights <span class="ot">&lt;-</span> <span class="fu">lapply</span>(neighbors, <span class="cf">function</span>(neighbor) {</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate weight based on some criteria (e.g., contiguity, distance)</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(neighbor)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the weight</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(weight)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign spatial weights to the original dataset</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>taiwan_village_dengue<span class="sc">$</span>spatial_weights <span class="ot">&lt;-</span> spatial_weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code calculates a spatial weights matrix using the queen contiguity criterion for the villages in Taiwan represented by polygons in the taiwan_village_dengue dataset, and then provides a summary of this matrix.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create wm_q with spatial weights</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> taiwan_village_dengue <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">st_contiguity</span>(geometry),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_weights</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>wm_q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2885 features and 16 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144
Geodetic CRS:  TWD97
First 10 features:
                                                                                                                                                                                                                                                                                                                                                nb
1                                                                                                                                                                                                                                                                                    2, 33, 34, 35, 36, 37, 38, 1533, 1534, 2070, 2071, 2072, 2073
1.1                                                                                                                                                                                                                                                                                  1, 33, 34, 35, 36, 37, 38, 1533, 1534, 2070, 2071, 2072, 2073
2   4, 5, 6, 7, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654, 1655, 1656, 1657, 1658, 1659, 1660, 1661, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1788, 1789, 1790, 1791, 1792, 1793, 1794, 1795, 1796, 1797, 1798, 1799, 2150, 2151, 2152, 2153, 2486, 2487, 2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497
2.1 3, 5, 6, 7, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654, 1655, 1656, 1657, 1658, 1659, 1660, 1661, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1788, 1789, 1790, 1791, 1792, 1793, 1794, 1795, 1796, 1797, 1798, 1799, 2150, 2151, 2152, 2153, 2486, 2487, 2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497
2.2 3, 4, 6, 7, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654, 1655, 1656, 1657, 1658, 1659, 1660, 1661, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1788, 1789, 1790, 1791, 1792, 1793, 1794, 1795, 1796, 1797, 1798, 1799, 2150, 2151, 2152, 2153, 2486, 2487, 2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497
2.3 3, 4, 5, 7, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654, 1655, 1656, 1657, 1658, 1659, 1660, 1661, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1788, 1789, 1790, 1791, 1792, 1793, 1794, 1795, 1796, 1797, 1798, 1799, 2150, 2151, 2152, 2153, 2486, 2487, 2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497
2.4 3, 4, 5, 6, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654, 1655, 1656, 1657, 1658, 1659, 1660, 1661, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1788, 1789, 1790, 1791, 1792, 1793, 1794, 1795, 1796, 1797, 1798, 1799, 2150, 2151, 2152, 2153, 2486, 2487, 2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497
3                                       9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 2155, 2156, 2300, 2301, 2302, 2303, 2304, 2305, 2306, 2307, 2308, 2309, 2310, 2311, 2312, 2313, 2314, 2315
3.1                                     8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 2155, 2156, 2300, 2301, 2302, 2303, 2304, 2305, 2306, 2307, 2308, 2309, 2310, 2311, 2312, 2313, 2314, 2315
3.2                                      8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 2155, 2156, 2300, 2301, 2302, 2303, 2304, 2305, 2306, 2307, 2308, 2309, 2310, 2311, 2312, 2313, 2314, 2315
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    wt
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308
1.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308
2               0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138
2.1             0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138
2.2             0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138
2.3             0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138
2.4             0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138, 0.01724138
3   0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915
3.1 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915
3.2 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915, 0.01694915
       VILLCODE COUNTYNAME TOWNNAME VILLNAME      VILLENG COUNTYID COUNTYCODE
1   67000350032     臺南市   安南區   青草里 Qingcao Vil.        D      67000
1.1 67000350032     臺南市   安南區   青草里 Qingcao Vil.        D      67000
2   67000270011     臺南市   仁德區   保安里  Bao'an Vil.        D      67000
2.1 67000270011     臺南市   仁德區   保安里  Bao'an Vil.        D      67000
2.2 67000270011     臺南市   仁德區   保安里  Bao'an Vil.        D      67000
2.3 67000270011     臺南市   仁德區   保安里  Bao'an Vil.        D      67000
2.4 67000270011     臺南市   仁德區   保安里  Bao'an Vil.        D      67000
3   67000370005     臺南市   中西區   赤嵌里 Chihkan Vil.        D      67000
3.1 67000370005     臺南市   中西區   赤嵌里 Chihkan Vil.        D      67000
3.2 67000370005     臺南市   中西區   赤嵌里 Chihkan Vil.        D      67000
    TOWNID TOWNCODE NOTE epi_week_num Village Num_Cases
1      D06 67000350 &lt;NA&gt;           37  青草里         1
1.1    D06 67000350 &lt;NA&gt;           41  青草里         1
2      D32 67000270 &lt;NA&gt;           31  保安里         1
2.1    D32 67000270 &lt;NA&gt;           37  保安里         3
2.2    D32 67000270 &lt;NA&gt;           41  保安里         5
2.3    D32 67000270 &lt;NA&gt;           41  安康里        12
2.4    D32 67000270 &lt;NA&gt;           45  安東里         7
3      D08 67000370 &lt;NA&gt;           35  赤嵌里         4
3.1    D08 67000370 &lt;NA&gt;           36  赤嵌里         1
3.2    D08 67000370 &lt;NA&gt;           37  赤嵌里         4
                          geometry spatial_weights
1   POLYGON ((120.1176 23.08387...             Inf
1.1 POLYGON ((120.1176 23.08387...             Inf
2   POLYGON ((120.2304 22.93544...      0.01851852
2.1 POLYGON ((120.2304 22.93544...      0.01851852
2.2 POLYGON ((120.2304 22.93544...      0.01851852
2.3 POLYGON ((120.2304 22.93544...      0.01851852
2.4 POLYGON ((120.2304 22.93544...      0.01851852
3   POLYGON ((120.2012 22.99966...       0.0212766
3.1 POLYGON ((120.2012 22.99966...       0.0212766
3.2 POLYGON ((120.2012 22.99966...       0.0212766</code></pre>
</div>
</div>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation-morans-i">3.3 Global Measures of Spatial Autocorrelation: Moran’s I</h3>
<section id="compute-global-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="compute-global-morans-i">3.3.1 Compute Global Moran’s I</h4>
<p>We will compute the Global Moran’s I value</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>moranI <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(wm_q<span class="sc">$</span>Num_Cases,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>nb,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>wt)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(moranI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ I: num 0.136
 $ K: num 15.1</code></pre>
</div>
</div>
</section>
<section id="global-morans-i-test" class="level4">
<h4 class="anchored" data-anchor-id="global-morans-i-test">3.3.2 Global Moran’s I Test</h4>
<p>We will be using Moran’s I statistics to test our taiwan_village_dengue dataset.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 45.35, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     1.360062e-01     -3.467406e-04      9.040175e-06 </code></pre>
</div>
</div>
<p>Based on the output, the Moran I statistic standard deviate measures the degree of spatial autocorrelation in the variable, Num_cases, in the taiwan_viilage_dengue dataset. In this case, it is 25.476, which indicates a high level of spatial autocorrelation.</p>
<p>In addition, the p-value is very low, at less than 2.2e-16, which indicates that the the <strong>spatial correlation is statistically significant</strong>. This rejects the null hypothesis that there is no spatial autocorrelation in the data.</p>
<p>The Moran I statistic of 0.073 also indicates that there is a positive spatial autocorrelation.</p>
<p>Based on the above explanation, it suggests that the areas with high number of dengue cases tend to be clustered together geographically.</p>
</section>
<section id="computing-global-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="computing-global-monte-carlo-morans-i">3.3.3 Computing Global Monte Carlo Moran’s I</h4>
<p>Let’s perform simulation on our Moran’s I test</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Monte Carlo Moran's I</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>global_moran_perm <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(wm_q<span class="sc">$</span>Num_Cases,  <span class="co"># Variable of interest</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                             wm_q<span class="sc">$</span>nb,        <span class="co"># Neighbour list object</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                             wm_q<span class="sc">$</span>wt,        <span class="co"># Spatial weights object</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nsim =</span> <span class="dv">999</span>)      <span class="co"># Number of permutations</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>global_moran_perm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.13601, observed rank = 1000, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>The result indicates that the spatial autocorrelation is statistically significant with the p-value of less than 0.01.</p>
</section>
<section id="visualising-global-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualising-global-monte-carlo-morans-i">3.3.4 Visualising Global Monte Carlo Moran’s I</h4>
<p>Let’s display our findings in a histogram so that we can visualise it better</p>
<p>Firstly, we can get a statistical summary of the Monte Carlo Moran’s I output</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(global_moran_perm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
-0.0088665 -0.0025018 -0.0002897 -0.0001968  0.0017910  0.0094111 </code></pre>
</div>
</div>
<p>Now, we can plot the histogram</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(global_moran_perm<span class="sc">$</span>res, </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">TRUE</span>, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks=</span><span class="dv">50</span>, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Simulated Moran's I"</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>,<span class="fl">0.02</span>))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="local-spatial-autocorrelation-analysis-by-using-sfdep-methods" class="level2">
<h2 class="anchored" data-anchor-id="local-spatial-autocorrelation-analysis-by-using-sfdep-methods">4 Local Spatial Autocorrelation Analysis by using sfdep methods</h2>
<section id="compute-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="compute-local-morans-i">4.1 Compute Local Moran’s I</h3>
<p>We will compute the Local Moran’s I value</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lisa <span class="ot">&lt;-</span> wm_q <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    Num_Cases, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_moran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above code would create a new sf file called “lisa” which stores the important information for the local moran’s I values (such as ii, eii, var_ii, etc)</p>
<p><img src="images/clipboard-3086410928.png" class="img-fluid"></p>
</section>
<section id="visualising-local-morans-i-and-p-value" class="level3">
<h3 class="anchored" data-anchor-id="visualising-local-morans-i-and-p-value">4.2 Visualising local Moran’s I and p-value</h3>
<p>For effective comparison, it will be better for us to plot both maps next to each other as shown below.</p>
<p>We will create a choropeth map by using the values in the “ii” field in lisa sf for the local Moran’s I, and the values in the “p_ii_sim” field in lisa sf for the p-value.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>) <span class="sc">+</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"local Moran's I of Num_Cases"</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.8</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii"</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.001"</span>, <span class="st">"0.01"</span>, <span class="st">"0.05"</span>, <span class="st">"Not sig"</span>)) <span class="sc">+</span> </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"p-value of local Moran's I"</span>,</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.8</span>)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1, map2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualising-lisa-map" class="level3">
<h3 class="anchored" data-anchor-id="visualising-lisa-map">4.3 <strong>Visualising LISA map</strong></h3>
<p>We will plot the LISA map to check for any kinds of outliers and clusters. It is done by combining the Local Moran’s I of the different areas and their respective p-values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>lisa_sig <span class="ot">&lt;-</span> lisa  <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_ii <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa_sig) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"mean"</span>) <span class="sc">+</span> </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the above map, and comparing it with our initial distribution map (below), we can observe that:</p>
<p><img src="images/clipboard-3680948792.png" class="img-fluid" width="451"></p>
<ul>
<li><p>Areas highlighted in red as classified as <strong>High-High Clusters (red)</strong>, where there are a high number of dengue cases, and it could also indicate that it is surrounded by areas with high dengue case counts. Comparing it to our initial distribution map that we plot in the beginning (in our join-operation), we can see that the areas with higher dengue cases are situated in area where it is highlighted in a darker shade of blue (ranging from 76.2 to 616.0 cases)</p>
<ul>
<li>This means that local authorities should focus on the public health efforts in these areas as they are more prone to an outbreak or transmission.</li>
</ul></li>
<li><p>Areas highlighted in red as classified as <strong>Low-Low Clusters (green)</strong>, where there are a lower number of dengue cases, and it could also indicate that it is surrounded by areas with low dengue case counts. Comparing to the initial distribution map (shown before this), we can see that the Low-Low Clusters are mostly situated at areas where there are lower number of cases (below 47.8)</p>
<ul>
<li>This means that public health efforts in these areas are well-maintained and there may be prevention measures in place when there is an outbreak or transmission.</li>
</ul></li>
<li><p>For both types of outliers, the High-Low (highlighted in yellow) and Low-High (highlighted in purple) outlier areas, they are a high and low number of cases respectively. However, they are surrounded by areas where there is a low or high number of cases respectively, which is contradictory to the actual situation in their areas.</p>
<ul>
<li><p>For High-Low outlier areas, it means that local authorities should seriously look into these areas as they are more prone to an outbreak or transmission, even though they are surrounded by areas with low case counts.</p></li>
<li><p>For Low-High outlier areas, it means that the area is well-prepared with preventive measures when there is an outbreak or transmission. This means that it is worth looking into the preventive strategies that they have in-place, which could be adopted by the areas with high case counts in the future.</p></li>
</ul></li>
</ul>
</section>
<section id="conclusion-for-local-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-for-local-spatial-autocorrelation">4.4 Conclusion for Local Spatial Autocorrelation</h3>
<ul>
<li><p>It is interesting to gain more insights into the different areas by filtering the areas based on the Moran’s I test and p-value, which has significantly helped in identifying clusters which have a high or low number of cases.</p></li>
<li><p>It is also able to identify outlier areas which is interesting to dive into as it indicates which area is more prone to an outbreak, or area where preventive measures are in-place, despite being surrounded by areas which has a different case counts.</p></li>
</ul>
</section>
</section>
<section id="hotspot-analysis-by-using-sfdep-methods" class="level2">
<h2 class="anchored" data-anchor-id="hotspot-analysis-by-using-sfdep-methods">5 Hotspot Analysis by using sfdep methods</h2>
<p>After performing the Global and Local Autocorrelation Analysis, let us move on to Analysing the Emerging Hotspots in our research in the dengue cases in Tainan City.</p>
<section id="performing-hot-spot-and-cold-spot-area-analysis-hcsa" class="level3">
<h3 class="anchored" data-anchor-id="performing-hot-spot-and-cold-spot-area-analysis-hcsa">5.1 Performing Hot Spot and Cold Spot Area Analysis (HCSA)</h3>
<p>In the previous section, we have used Moran’s I to identify clusters and outliers.</p>
<p>Now, we will use <strong>Gi*</strong>, which is a spatial autocorrelation statistic tool, to identify statistically hot (clusters of high values) or cold spots (clusters of low values) based on spatial weights.</p>
<section id="computing-spatial-weights" class="level4">
<h4 class="anchored" data-anchor-id="computing-spatial-weights">5.1.1 Computing spatial weights</h4>
<p>We have to compute the spatial weights before we can proceed to computing the local Gi* statistics</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>wm_idw <span class="ot">&lt;-</span> taiwan_village_dengue <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">st_contiguity</span>(geometry),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_inverse_distance</span>(nb, geometry,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="computing-local-gi-statistics" class="level4">
<h4 class="anchored" data-anchor-id="computing-local-gi-statistics">5.1.2 Computing local Gi* statistics</h4>
<p>Next, we will compute the local Gi* statistics</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>HCSA <span class="ot">&lt;-</span> wm_idw <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_Gi =</span> <span class="fu">local_gstar_perm</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    Num_Cases, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_Gi)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>HCSA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2885 features and 24 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144
Geodetic CRS:  TWD97
# A tibble: 2,885 × 25
   gi_star     e_gi  var_gi p_value   p_sim p_folded_sim skewness kurtosis nb   
     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;nb&gt; 
 1  -2.67  0.000329 8.45e-9  -2.75  0.00592         0.02     0.01   0.424  &lt;int&gt;
 2  -2.67  0.000315 9.20e-9  -2.50  0.0125          0.02     0.01   0.693  &lt;int&gt;
 3  -2.16  0.000350 2.53e-9  -2.16  0.0304          0.02     0.01   0.248  &lt;int&gt;
 4  -2.16  0.000350 1.76e-9  -2.60  0.00943         0.02     0.01   0.0297 &lt;int&gt;
 5  -2.16  0.000353 2.61e-9  -2.19  0.0282          0.04     0.02   0.411  &lt;int&gt;
 6  -2.16  0.000355 1.79e-9  -2.71  0.00674         0.02     0.01   0.252  &lt;int&gt;
 7  -2.16  0.000352 2.18e-9  -2.38  0.0174          0.02     0.01   0.477  &lt;int&gt;
 8  -0.485 0.000346 2.31e-9  -0.479 0.632           0.76     0.38   0.528  &lt;int&gt;
 9  -0.485 0.000353 2.75e-9  -0.561 0.574           0.52     0.26   0.256  &lt;int&gt;
10  -0.485 0.000348 2.28e-9  -0.514 0.607           0.62     0.31   0.475  &lt;int&gt;
# ℹ 2,875 more rows
# ℹ 16 more variables: wt &lt;list&gt;, VILLCODE &lt;chr&gt;, COUNTYNAME &lt;chr&gt;,
#   TOWNNAME &lt;chr&gt;, VILLNAME &lt;chr&gt;, VILLENG &lt;chr&gt;, COUNTYID &lt;chr&gt;,
#   COUNTYCODE &lt;chr&gt;, TOWNID &lt;chr&gt;, TOWNCODE &lt;chr&gt;, NOTE &lt;chr&gt;,
#   epi_week_num &lt;dbl&gt;, Village &lt;chr&gt;, Num_Cases &lt;int&gt;, geometry &lt;POLYGON [°]&gt;,
#   spatial_weights &lt;list&gt;</code></pre>
</div>
</div>
</section>
<section id="visualising-gi" class="level4">
<h4 class="anchored" data-anchor-id="visualising-gi">5.1.3 Visualising Gi*</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>) <span class="sc">+</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above plot, we are able to see the spatial clustering pattern. We could see that most of the area have a lower density (in orange).</p>
<ul>
<li>The areas with higher density (in light and dark green) towards the center of the map. The high density areas indicates that there are a high Gi* value, which relates to an obvious trend of clusters of dengue cases.</li>
<li>The areas with low density (in orange) indicates that there is a low Gi* value, which means that there might be a lower number of dengue clusters, or that there is randomness in the distribution of cases.</li>
</ul>
</section>
<section id="visualising-p-value-of-hcsa" class="level4">
<h4 class="anchored" data-anchor-id="visualising-p-value-of-hcsa"><strong>5.1.4 Visualising p-value of HCSA</strong></h4>
<p>Let’s plot the p-value of the areas to check the significance level</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_sim"</span>) <span class="sc">+</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that some areas have a higher significance level (in dark brown), while most of it have a lower significance level (in beige)</p>
</section>
<section id="visualising-local-hcsa" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-hcsa"><strong>5.1.5 Visualising Local HCSA</strong></h4>
<p>Now, let’s put both maps (Gi* and p-value) side by side to make a comparison</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>) <span class="sc">+</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Gi* of GDPPC"</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.8</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_value"</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>),</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.001"</span>, <span class="st">"0.01"</span>, <span class="st">"0.05"</span>, <span class="st">"Not sig"</span>)) <span class="sc">+</span> </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"p-value of Gi*"</span>,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.8</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1, map2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the maps, we can see an obvious trend, which is that areas with lower density for Gi* (means lower number of dengue cluster) has a low p-value (0.001). This means that areas with lower number of dengue cluster has a higher significance level, and that indicates that the dengue cases are influenced by geographic proximity.</p>
</section>
<section id="visualising-hot-spot-and-cold-spot-areas" class="level4">
<h4 class="anchored" data-anchor-id="visualising-hot-spot-and-cold-spot-areas"><strong>5.1.6 Visualising hot spot and cold spot areas</strong></h4>
<p>Now, we can plot the significant hotspot and coldspot (p-values less than 0.05)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>HCSA_sig <span class="ot">&lt;-</span> HCSA  <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA_sig) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>) <span class="sc">+</span> </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the map, we can observe that:</p>
<ul>
<li><p>There is 1 significant hotspot in the middle of the map (in dark green), with gi_star between 15-20, which indicates that it has a higher dengue cluster, and is surrounded by areas which are hotspots too.</p>
<ul>
<li>This supports the findings from our LISA map and the initial distribution map, where the central area of Tainan City has a higher dengue cluster (higher number of dengue cases)</li>
</ul></li>
<li><p>There are a few smaller hotspots (light green) scattered around the middle of the map.</p></li>
<li><p>The areas towards the sides of the map has a number of coldspots (light orange), with gi_star value between -5 to 0, which indicates there is a low dengue cluster.</p></li>
</ul>
<p>Let’s find the details of the hotspot and coldspot, which we will be using it in 5.2 in analysing emerging hotspots</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter HCSA to include only rows where p_sim &lt; 0.05</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>HCSA_sig <span class="ot">&lt;-</span> HCSA <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the row with the highest gi_star among the filtered data</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>hotspot <span class="ot">&lt;-</span> HCSA_sig <span class="sc">%&gt;%</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gi_star <span class="sc">==</span> <span class="fu">max</span>(gi_star))</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the hotspot</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Hotspot with the highest gi_star and p_sim &lt; 0.05:"</span>, hotspot<span class="sc">$</span>VILLNAME, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Hotspot with the highest gi_star and p_sim &lt; 0.05: 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 溪墘里 </code></pre>
</div>
</div>
<p>So, 溪墘里 is the hotspot. :)</p>
</section>
</section>
<section id="analysing-emerging-hotspot" class="level3">
<h3 class="anchored" data-anchor-id="analysing-emerging-hotspot">5.2 Analysing Emerging Hotspot</h3>
<p>Since we have computed the Gi* values, which shows us the Hotspots and Coldspots, we will move on to performing Mann-Kendall test to look for any trend in the spots.</p>
<p>However, we need to compute the local Gi* statistics using the spacetime dataset, dengue_st, which we have created in 2.4.</p>
<section id="computing-gi" class="level4">
<h4 class="anchored" data-anchor-id="computing-gi">5.2.1 Computing Gi*</h4>
<p>We will use dengue_st to compute the Gi*, where the geometry is in the spacetime dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Activate the geometry column</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>dengue_st <span class="ot">&lt;-</span> <span class="fu">activate</span>(dengue_st, <span class="st">"geometry"</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial weights</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>tainan_dengue_nb <span class="ot">&lt;-</span> dengue_st <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">st_contiguity</span>(geometry),</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_inverse_distance</span>(nb, geometry, <span class="at">scale =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_nbs</span>(<span class="st">"nb"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_wts</span>(<span class="st">"wt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at the first 5 rows</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tainan_dengue_nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    VILLNAME epi_week_num Num_Cases                       nb
451   青草里           31         0              6, 118, 157
452   保安里           31         1       126, 136, 164, 190
453   赤嵌里           31         0         68, 69, 166, 177
454   大成里           31         0         94, 97, 100, 104
455   城北里           31         0         12, 13, 216, 222
456   城南里           31         0 1, 12, 13, 118, 157, 216
                                                                  wt
451                                  0.3730707, 0.5166453, 0.3002859
452                       0.3310971, 0.3966444, 0.7717933, 0.8772257
453                           1.223481, 1.545931, 1.357812, 1.700209
454                           1.286031, 2.993138, 1.862438, 2.166602
455                       1.4041477, 1.1310013, 0.6159622, 0.4135746
456 0.3730707, 0.7009117, 0.4433391, 0.3101907, 0.3335912, 0.3828707</code></pre>
</div>
</div>
</section>
<section id="computing-local-gi" class="level4">
<h4 class="anchored" data-anchor-id="computing-local-gi">5.2.2 Computing Local Gi*</h4>
<p>Now, we need to compute the Local Gi* for each villages, using the tainan_dengue_nb which we have created in 5.1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>gi_stars <span class="ot">&lt;-</span> tainan_dengue_nb <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(epi_week_num) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gi_star =</span> <span class="fu">ifelse</span>(<span class="fu">sapply</span>(nb, is.list), </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">local_gstar_perm</span>(Num_Cases, nb, wt), </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gi_star)) <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="computing-mann-kendall-test" class="level4">
<h4 class="anchored" data-anchor-id="computing-mann-kendall-test">5.2.3 Computing Mann-Kendall Test</h4>
<p>Now, we will use Mann-Kendall Test to evaluate the trend of the hotspot. We have previously found that 溪墘里 is the hotspot when we were analysing HCSA in step 5.1, so we will input 溪墘里 into our mann-kendall test</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>cbg <span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VILLNAME <span class="sc">==</span> <span class="st">"溪墘里"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VILLNAME, epi_week_num, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s install Kendall</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"Kendall"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s plot the result using ggplot2</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VILLNAME) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">6 Conclusion</h2>
<p>It is interesting to use the different tools, such as Local and Global spatial autocorrelation, to find the clusters or hotspots within the area of focus, in this case it is the dengue cases in Tainan City. Through this exercise, we are able to find out which village has the highest number of dengue cases, and with the highest cluster. In addition, it would be beneficial for relevant authorities to see which village requires evaluation in their precautionary measure against dengue (in areas with high cluster), and how areas with low clusters are able to keep their case counts low even during a peak dengue season.</p>
<p>This has showed that the distribution of dengue fever outbreak at Tainan City, Taiwan are dependent on space and time, as the numbers differs from villages, and the numbers changes over the week. Moreover, we are able to determine if the distribution of dengue cases are spatial and spatio-temporal dependent.</p>
<p>Lastly, we are able to identify the hotspots with high cluster in our analysis. Furthermore, we identified other villages with smaller clusters and low number of cases.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>